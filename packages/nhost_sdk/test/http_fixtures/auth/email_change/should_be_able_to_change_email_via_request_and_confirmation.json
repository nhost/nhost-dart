{
  "name": "auth/email_change/should_be_able_to_change_email_via_request_and_confirmation.json",
  "interactions": [
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:9001/auth/register",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"email\":\"user-1@nhost.io\",\"password\":\"password-1\",\"user_data\":{},\"cookie\":false}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "set-cookie": "refresh_token=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT,permission_variables=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "x-ratelimit-reset": "1634525484",
          "date": "Mon, 18 Oct 2021 02:37:47 GMT",
          "x-ratelimit-limit": "1000",
          "vary": "Origin",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "x-ratelimit-remaining": "941",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "access-control-allow-credentials": "true",
          "keep-alive": "timeout=5",
          "content-length": "612",
          "x-download-options": "noopen",
          "etag": "W/\"264-qQK77MoDpl1q2Yxsk5pIC242M7w\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"jwt_token\":\"eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLXVzZXItaWQiOiI5OTgwMzJhNi1jMmZlLTQ2MWQtOTA1OS1mMDVkYmNhNjk4OTMiLCJ4LWhhc3VyYS1hbGxvd2VkLXJvbGVzIjpbInVzZXIiLCJtZSJdLCJ4LWhhc3VyYS1kZWZhdWx0LXJvbGUiOiJ1c2VyIn0sInN1YiI6Ijk5ODAzMmE2LWMyZmUtNDYxZC05MDU5LWYwNWRiY2E2OTg5MyIsImlzcyI6Im5ob3N0IiwiaWF0IjoxNjM0NTI0NjY4LCJleHAiOjE2MzQ1MjU1Njh9.guELhsdNocX0D1x9Z-zC9IQAGSacrVE3o176Al8GGII\",\"jwt_expires_in\":900000,\"user\":{\"id\":\"998032a6-c2fe-461d-9059-f05dbca69893\",\"display_name\":\"user-1@nhost.io\",\"email\":\"user-1@nhost.io\"},\"refresh_token\":\"50c879c3-252c-493a-aefe-0e25cf311f18\"}"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:9001/auth/change-email/request",
        "headers": {
          "content-type": "application/json; charset=utf-8",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLXVzZXItaWQiOiI5OTgwMzJhNi1jMmZlLTQ2MWQtOTA1OS1mMDVkYmNhNjk4OTMiLCJ4LWhhc3VyYS1hbGxvd2VkLXJvbGVzIjpbInVzZXIiLCJtZSJdLCJ4LWhhc3VyYS1kZWZhdWx0LXJvbGUiOiJ1c2VyIn0sInN1YiI6Ijk5ODAzMmE2LWMyZmUtNDYxZC05MDU5LWYwNWRiY2E2OTg5MyIsImlzcyI6Im5ob3N0IiwiaWF0IjoxNjM0NTI0NjY4LCJleHAiOjE2MzQ1MjU1Njh9.guELhsdNocX0D1x9Z-zC9IQAGSacrVE3o176Al8GGII"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"new_email\":\"new-user-1@nhost.io\"}"
        }
      },
      "response": {
        "status": 204,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "x-ratelimit-reset": "1634525484",
          "date": "Mon, 18 Oct 2021 02:37:48 GMT",
          "x-ratelimit-limit": "1000",
          "vary": "Origin",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "x-ratelimit-remaining": "940",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "access-control-allow-credentials": "true",
          "keep-alive": "timeout=5",
          "x-download-options": "noopen",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "iso-8859-1",
          "string": ""
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:8080/v1/graphql",
        "headers": {
          "content-type": "application/json",
          "Accept": "*/*",
          "X-Hasura-Admin-Secret": "123456"
        },
        "body": {
          "encoding": "iso-8859-1",
          "string": "{\"operationName\":null,\"variables\":{\"userId\":\"998032a6-c2fe-461d-9059-f05dbca69893\"},\"query\":\"query ChangeTickerForUser($userId: uuid!) {\\n  __typename\\n  users(where: {id: {_eq: $userId}}) {\\n    __typename\\n    account {\\n      __typename\\n      ticket\\n    }\\n  }\\n}\"}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "content-type": "application/json; charset=utf-8",
          "date": "Mon, 18 Oct 2021 02:37:48 GMT",
          "transfer-encoding": "chunked",
          "content-encoding": "gzip",
          "server": "Warp/3.3.10",
          "x-request-id": "66d1bdaa-2dbc-4bb8-ae4a-357e71d9c8fa"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"data\":{\"__typename\":\"query_root\",\"users\":[{\"__typename\":\"users\",\"account\":{\"__typename\":\"auth_accounts\",\"ticket\":\"9dffad1a-be68-4470-af40-6d77c2ceb56e\"}}]}}"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:9001/auth/change-email/change",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"ticket\":\"9dffad1a-be68-4470-af40-6d77c2ceb56e\"}"
        }
      },
      "response": {
        "status": 204,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "x-ratelimit-reset": "1634525484",
          "date": "Mon, 18 Oct 2021 02:37:48 GMT",
          "x-ratelimit-limit": "1000",
          "vary": "Origin",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "x-ratelimit-remaining": "939",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "access-control-allow-credentials": "true",
          "keep-alive": "timeout=5",
          "x-download-options": "noopen",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "iso-8859-1",
          "string": ""
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:9001/auth/logout?refresh_token=50c879c3-252c-493a-aefe-0e25cf311f18",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"all\":false}"
        }
      },
      "response": {
        "status": 204,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "x-ratelimit-reset": "1634525484",
          "date": "Mon, 18 Oct 2021 02:37:48 GMT",
          "x-ratelimit-limit": "1000",
          "vary": "Origin",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "x-ratelimit-remaining": "938",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "access-control-allow-credentials": "true",
          "keep-alive": "timeout=5",
          "x-download-options": "noopen",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "iso-8859-1",
          "string": ""
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:9001/auth/login",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"email\":\"new-user-1@nhost.io\",\"password\":\"password-1\",\"cookie\":false}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "set-cookie": "refresh_token=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT,permission_variables=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "x-ratelimit-reset": "1634525484",
          "date": "Mon, 18 Oct 2021 02:37:48 GMT",
          "x-ratelimit-limit": "1000",
          "vary": "Origin",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "x-ratelimit-remaining": "937",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "access-control-allow-credentials": "true",
          "keep-alive": "timeout=5",
          "content-length": "616",
          "x-download-options": "noopen",
          "etag": "W/\"268-BPBE66VKOUZuHUHXLS/RcbaLMeI\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"jwt_token\":\"eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLXVzZXItaWQiOiI5OTgwMzJhNi1jMmZlLTQ2MWQtOTA1OS1mMDVkYmNhNjk4OTMiLCJ4LWhhc3VyYS1hbGxvd2VkLXJvbGVzIjpbInVzZXIiLCJtZSJdLCJ4LWhhc3VyYS1kZWZhdWx0LXJvbGUiOiJ1c2VyIn0sInN1YiI6Ijk5ODAzMmE2LWMyZmUtNDYxZC05MDU5LWYwNWRiY2E2OTg5MyIsImlzcyI6Im5ob3N0IiwiaWF0IjoxNjM0NTI0NjY4LCJleHAiOjE2MzQ1MjU1Njh9.guELhsdNocX0D1x9Z-zC9IQAGSacrVE3o176Al8GGII\",\"jwt_expires_in\":900000,\"user\":{\"id\":\"998032a6-c2fe-461d-9059-f05dbca69893\",\"display_name\":\"user-1@nhost.io\",\"email\":\"new-user-1@nhost.io\"},\"refresh_token\":\"cd9d085d-a1ba-479a-a188-86a67e0ebb21\"}"
        }
      }
    }
  ]
}
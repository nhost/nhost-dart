{
  "name": "auth/multi-factor_authentication/should_require_totp_for_login_once_enabled.json",
  "interactions": [
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:1337/v1/auth/signup/email-password",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"email\":\"user-1@nhost.io\",\"password\":\"password-1\"}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "date": "Thu, 03 Feb 2022 08:55:15 GMT",
          "access-control-allow-origin": "*",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "content-length": "911",
          "x-download-options": "noopen",
          "etag": "W/\"38f-6lqLhqHGtkLfDCpJ0VAfWfx1AS0\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"session\":{\"accessToken\":\"eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLWFsbG93ZWQtcm9sZXMiOlsidXNlciIsIm1lIl0sIngtaGFzdXJhLWRlZmF1bHQtcm9sZSI6InVzZXIiLCJ4LWhhc3VyYS11c2VyLWlkIjoiNTA5ZjZkODctNjdkZi00OGM5LTlhZWMtMmEwMTM4MzZkNTFlIiwieC1oYXN1cmEtdXNlci1pc0Fub255bW91cyI6ImZhbHNlIn0sInN1YiI6IjUwOWY2ZDg3LTY3ZGYtNDhjOS05YWVjLTJhMDEzODM2ZDUxZSIsImlzcyI6Imhhc3VyYS1hdXRoIiwiaWF0IjoxNjQzODc4NTE1LCJleHAiOjE2NDM4Nzk0MTV9.T840EFA3iztsHEIepZgwOsyMmlo95E7W8p05SCyxNgk\",\"accessTokenExpiresIn\":900,\"refreshToken\":\"1c154fe9-81eb-49ab-a2d1-4a69ccff3ac5\",\"user\":{\"id\":\"509f6d87-67df-48c9-9aec-2a013836d51e\",\"createdAt\":\"2022-02-03T08:55:15.9469+00:00\",\"displayName\":\"user-1@nhost.io\",\"avatarUrl\":\"https://s.gravatar.com/avatar/d86c12c3233e91ec90869a1f874cdf0e?r=g&default=blank\",\"locale\":\"en\",\"email\":\"user-1@nhost.io\",\"isAnonymous\":false,\"defaultRole\":\"user\",\"roles\":[\"user\",\"me\"]}},\"mfa\":null}"
        }
      }
    },
    {
      "request": {
        "method": "get",
        "uri": "http://localhost:1337/v1/auth/mfa/totp/generate",
        "headers": {
          "authorization": "Bearer eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLWFsbG93ZWQtcm9sZXMiOlsidXNlciIsIm1lIl0sIngtaGFzdXJhLWRlZmF1bHQtcm9sZSI6InVzZXIiLCJ4LWhhc3VyYS11c2VyLWlkIjoiNTA5ZjZkODctNjdkZi00OGM5LTlhZWMtMmEwMTM4MzZkNTFlIiwieC1oYXN1cmEtdXNlci1pc0Fub255bW91cyI6ImZhbHNlIn0sInN1YiI6IjUwOWY2ZDg3LTY3ZGYtNDhjOS05YWVjLTJhMDEzODM2ZDUxZSIsImlzcyI6Imhhc3VyYS1hdXRoIiwiaWF0IjoxNjQzODc4NTE1LCJleHAiOjE2NDM4Nzk0MTV9.T840EFA3iztsHEIepZgwOsyMmlo95E7W8p05SCyxNgk"
        },
        "body": null
      },
      "response": {
        "status": 200,
        "headers": {
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "date": "Thu, 03 Feb 2022 08:55:16 GMT",
          "access-control-allow-origin": "*",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "content-length": "4333",
          "x-download-options": "noopen",
          "etag": "W/\"10ed-8r5pG0doZAre4ZCi7fV9PHwM8jE\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"imageUrl\":\"data:image/png;base64,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\",\"totpSecret\":\"JELFABD5OJPAKQCP\"}"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:1337/v1/auth/user/mfa",
        "headers": {
          "content-type": "application/json; charset=utf-8",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLWFsbG93ZWQtcm9sZXMiOlsidXNlciIsIm1lIl0sIngtaGFzdXJhLWRlZmF1bHQtcm9sZSI6InVzZXIiLCJ4LWhhc3VyYS11c2VyLWlkIjoiNTA5ZjZkODctNjdkZi00OGM5LTlhZWMtMmEwMTM4MzZkNTFlIiwieC1oYXN1cmEtdXNlci1pc0Fub255bW91cyI6ImZhbHNlIn0sInN1YiI6IjUwOWY2ZDg3LTY3ZGYtNDhjOS05YWVjLTJhMDEzODM2ZDUxZSIsImlzcyI6Imhhc3VyYS1hdXRoIiwiaWF0IjoxNjQzODc4NTE1LCJleHAiOjE2NDM4Nzk0MTV9.T840EFA3iztsHEIepZgwOsyMmlo95E7W8p05SCyxNgk"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"code\":\"634319\",\"activeMfaType\":\"totp\"}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "date": "Thu, 03 Feb 2022 08:55:16 GMT",
          "access-control-allow-origin": "*",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "content-type": "text/html; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "content-length": "2",
          "x-download-options": "noopen",
          "etag": "W/\"2-nOO9QiTIwXgNtWtBJezz8kv3SLc\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "OK"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:1337/v1/auth/signout",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"refreshToken\":\"1c154fe9-81eb-49ab-a2d1-4a69ccff3ac5\",\"all\":false}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "date": "Thu, 03 Feb 2022 08:55:16 GMT",
          "access-control-allow-origin": "*",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "content-type": "text/html; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "content-length": "2",
          "x-download-options": "noopen",
          "etag": "W/\"2-nOO9QiTIwXgNtWtBJezz8kv3SLc\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "OK"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:1337/v1/auth/signin/email-password",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"email\":\"user-1@nhost.io\",\"password\":\"password-1\"}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "date": "Thu, 03 Feb 2022 08:55:16 GMT",
          "access-control-allow-origin": "*",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "content-length": "80",
          "x-download-options": "noopen",
          "etag": "W/\"50-pWvlBqDgWo6EeCtbUYX/bdhMklA\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"session\":null,\"mfa\":{\"ticket\":\"mfaTotp:969f577c-272d-4b20-9e0e-0b21f12dc231\"}}"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:1337/v1/auth/signin/mfa/totp",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"otp\":\"634319\",\"ticket\":\"mfaTotp:969f577c-272d-4b20-9e0e-0b21f12dc231\"}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "date": "Thu, 03 Feb 2022 08:55:16 GMT",
          "access-control-allow-origin": "*",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "content-length": "911",
          "x-download-options": "noopen",
          "etag": "W/\"38f-77T3pC/Ec/qkMEfQrP1CkbM2tUk\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"session\":{\"accessToken\":\"eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLWFsbG93ZWQtcm9sZXMiOlsidXNlciIsIm1lIl0sIngtaGFzdXJhLWRlZmF1bHQtcm9sZSI6InVzZXIiLCJ4LWhhc3VyYS11c2VyLWlkIjoiNTA5ZjZkODctNjdkZi00OGM5LTlhZWMtMmEwMTM4MzZkNTFlIiwieC1oYXN1cmEtdXNlci1pc0Fub255bW91cyI6ImZhbHNlIn0sInN1YiI6IjUwOWY2ZDg3LTY3ZGYtNDhjOS05YWVjLTJhMDEzODM2ZDUxZSIsImlzcyI6Imhhc3VyYS1hdXRoIiwiaWF0IjoxNjQzODc4NTE2LCJleHAiOjE2NDM4Nzk0MTZ9.5_dlReqxyfteoE-6c7Lt5mWBrIysQ1j77gpqdXlYmiY\",\"accessTokenExpiresIn\":900,\"refreshToken\":\"b0546cc8-5a4d-4169-9f59-c632de80e158\",\"user\":{\"id\":\"509f6d87-67df-48c9-9aec-2a013836d51e\",\"createdAt\":\"2022-02-03T08:55:15.9469+00:00\",\"displayName\":\"user-1@nhost.io\",\"avatarUrl\":\"https://s.gravatar.com/avatar/d86c12c3233e91ec90869a1f874cdf0e?r=g&default=blank\",\"locale\":\"en\",\"email\":\"user-1@nhost.io\",\"isAnonymous\":false,\"defaultRole\":\"user\",\"roles\":[\"user\",\"me\"]}},\"mfa\":null}"
        }
      }
    }
  ]
}
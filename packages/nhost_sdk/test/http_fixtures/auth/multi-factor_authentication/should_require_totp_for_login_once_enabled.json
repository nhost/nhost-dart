{
  "name": "auth/multi-factor_authentication/should_require_totp_for_login_once_enabled.json",
  "interactions": [
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:1337/v1/auth/signup/email-password",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"email\":\"user-1@nhost.io\",\"password\":\"password-1\"}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "date": "Fri, 28 Jan 2022 06:35:05 GMT",
          "access-control-allow-origin": "*",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "content-length": "913",
          "x-download-options": "noopen",
          "etag": "W/\"391-kt8u0wpn1ZmPRQ/Wese49CR5JKo\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"session\":{\"accessToken\":\"eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLWFsbG93ZWQtcm9sZXMiOlsidXNlciIsIm1lIl0sIngtaGFzdXJhLWRlZmF1bHQtcm9sZSI6InVzZXIiLCJ4LWhhc3VyYS11c2VyLWlkIjoiODhhNWU0ZjctNDI3Mi00ZGFlLWJhMGItM2E1Njc0OWRmODhkIiwieC1oYXN1cmEtdXNlci1pc0Fub255bW91cyI6ImZhbHNlIn0sInN1YiI6Ijg4YTVlNGY3LTQyNzItNGRhZS1iYTBiLTNhNTY3NDlkZjg4ZCIsImlzcyI6Imhhc3VyYS1hdXRoIiwiaWF0IjoxNjQzMzUxNzA1LCJleHAiOjE2NDMzNTI2MDV9.02ArH4rApw7Ax6zVTNJTfraLHj7GvtcJ4IdZVPWh47c\",\"accessTokenExpiresIn\":900,\"refreshToken\":\"2d4ac4cc-e81c-48bb-a645-3e9918dfafbe\",\"user\":{\"id\":\"88a5e4f7-4272-4dae-ba0b-3a56749df88d\",\"createdAt\":\"2022-01-28T06:35:05.083347+00:00\",\"displayName\":\"user-1@nhost.io\",\"avatarUrl\":\"https://s.gravatar.com/avatar/d86c12c3233e91ec90869a1f874cdf0e?r=g&default=blank\",\"locale\":\"en\",\"email\":\"user-1@nhost.io\",\"isAnonymous\":false,\"defaultRole\":\"user\",\"roles\":[\"user\",\"me\"]}},\"mfa\":null}"
        }
      }
    },
    {
      "request": {
        "method": "get",
        "uri": "http://localhost:1337/v1/auth/mfa/totp/generate",
        "headers": {
          "authorization": "Bearer eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLWFsbG93ZWQtcm9sZXMiOlsidXNlciIsIm1lIl0sIngtaGFzdXJhLWRlZmF1bHQtcm9sZSI6InVzZXIiLCJ4LWhhc3VyYS11c2VyLWlkIjoiODhhNWU0ZjctNDI3Mi00ZGFlLWJhMGItM2E1Njc0OWRmODhkIiwieC1oYXN1cmEtdXNlci1pc0Fub255bW91cyI6ImZhbHNlIn0sInN1YiI6Ijg4YTVlNGY3LTQyNzItNGRhZS1iYTBiLTNhNTY3NDlkZjg4ZCIsImlzcyI6Imhhc3VyYS1hdXRoIiwiaWF0IjoxNjQzMzUxNzA1LCJleHAiOjE2NDMzNTI2MDV9.02ArH4rApw7Ax6zVTNJTfraLHj7GvtcJ4IdZVPWh47c"
        },
        "body": null
      },
      "response": {
        "status": 200,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "date": "Fri, 28 Jan 2022 06:35:05 GMT",
          "access-control-allow-origin": "*",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "content-length": "4321",
          "x-download-options": "noopen",
          "etag": "W/\"10e1-7ZT1L9yXTsjVSNnH3Pxg/j5Yf4w\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"imageUrl\":\"data:image/png;base64,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\",\"totpSecret\":\"CBRBSJIQHY6FKKDO\"}"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:1337/v1/auth/user/mfa",
        "headers": {
          "content-type": "application/json; charset=utf-8",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLWFsbG93ZWQtcm9sZXMiOlsidXNlciIsIm1lIl0sIngtaGFzdXJhLWRlZmF1bHQtcm9sZSI6InVzZXIiLCJ4LWhhc3VyYS11c2VyLWlkIjoiODhhNWU0ZjctNDI3Mi00ZGFlLWJhMGItM2E1Njc0OWRmODhkIiwieC1oYXN1cmEtdXNlci1pc0Fub255bW91cyI6ImZhbHNlIn0sInN1YiI6Ijg4YTVlNGY3LTQyNzItNGRhZS1iYTBiLTNhNTY3NDlkZjg4ZCIsImlzcyI6Imhhc3VyYS1hdXRoIiwiaWF0IjoxNjQzMzUxNzA1LCJleHAiOjE2NDMzNTI2MDV9.02ArH4rApw7Ax6zVTNJTfraLHj7GvtcJ4IdZVPWh47c"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"code\":\"353061\",\"activeMfaType\":\"totp\"}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "date": "Fri, 28 Jan 2022 06:35:05 GMT",
          "access-control-allow-origin": "*",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "content-type": "text/html; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "content-length": "2",
          "x-download-options": "noopen",
          "etag": "W/\"2-nOO9QiTIwXgNtWtBJezz8kv3SLc\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "OK"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:1337/v1/auth/signout",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"refreshToken\":\"2d4ac4cc-e81c-48bb-a645-3e9918dfafbe\",\"all\":false}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "date": "Fri, 28 Jan 2022 06:35:05 GMT",
          "access-control-allow-origin": "*",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "content-type": "text/html; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "content-length": "2",
          "x-download-options": "noopen",
          "etag": "W/\"2-nOO9QiTIwXgNtWtBJezz8kv3SLc\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "OK"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:1337/v1/auth/signin/email-password",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"email\":\"user-1@nhost.io\",\"password\":\"password-1\"}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "date": "Fri, 28 Jan 2022 06:35:05 GMT",
          "access-control-allow-origin": "*",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "content-length": "80",
          "x-download-options": "noopen",
          "etag": "W/\"50-mUHFyVACn7g2uoABtIW0G2JStgs\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"session\":null,\"mfa\":{\"ticket\":\"mfaTotp:b2afc53e-5626-4378-83d6-9e10782b0c87\"}}"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:1337/v1/auth/signin/mfa/totp",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"otp\":\"353061\",\"ticket\":\"mfaTotp:b2afc53e-5626-4378-83d6-9e10782b0c87\"}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "date": "Fri, 28 Jan 2022 06:35:05 GMT",
          "access-control-allow-origin": "*",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "content-length": "913",
          "x-download-options": "noopen",
          "etag": "W/\"391-OH3a0BIQtU4CmrgNw8Ew9qXrsPo\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"session\":{\"accessToken\":\"eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLWFsbG93ZWQtcm9sZXMiOlsidXNlciIsIm1lIl0sIngtaGFzdXJhLWRlZmF1bHQtcm9sZSI6InVzZXIiLCJ4LWhhc3VyYS11c2VyLWlkIjoiODhhNWU0ZjctNDI3Mi00ZGFlLWJhMGItM2E1Njc0OWRmODhkIiwieC1oYXN1cmEtdXNlci1pc0Fub255bW91cyI6ImZhbHNlIn0sInN1YiI6Ijg4YTVlNGY3LTQyNzItNGRhZS1iYTBiLTNhNTY3NDlkZjg4ZCIsImlzcyI6Imhhc3VyYS1hdXRoIiwiaWF0IjoxNjQzMzUxNzA1LCJleHAiOjE2NDMzNTI2MDV9.02ArH4rApw7Ax6zVTNJTfraLHj7GvtcJ4IdZVPWh47c\",\"accessTokenExpiresIn\":900,\"refreshToken\":\"3d32ce2b-67b4-4e39-9874-d5e587de9d4b\",\"user\":{\"id\":\"88a5e4f7-4272-4dae-ba0b-3a56749df88d\",\"createdAt\":\"2022-01-28T06:35:05.083347+00:00\",\"displayName\":\"user-1@nhost.io\",\"avatarUrl\":\"https://s.gravatar.com/avatar/d86c12c3233e91ec90869a1f874cdf0e?r=g&default=blank\",\"locale\":\"en\",\"email\":\"user-1@nhost.io\",\"isAnonymous\":false,\"defaultRole\":\"user\",\"roles\":[\"user\",\"me\"]}},\"mfa\":null}"
        }
      }
    }
  ]
}
{
  "name": "auth/multi-factor_authentication/should_require_totp_for_login_once_enabled.json",
  "interactions": [
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:9001/auth/register",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"email\":\"user-1@nhost.io\",\"password\":\"password-1\",\"user_data\":{},\"cookie\":false}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "set-cookie": "refresh_token=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT,permission_variables=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "x-ratelimit-reset": "1634525484",
          "date": "Mon, 18 Oct 2021 02:37:51 GMT",
          "x-ratelimit-limit": "1000",
          "vary": "Origin",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "x-ratelimit-remaining": "922",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "access-control-allow-credentials": "true",
          "keep-alive": "timeout=5",
          "content-length": "612",
          "x-download-options": "noopen",
          "etag": "W/\"264-K9OBVs9k0QC0TsFLV+q8Zceyqlw\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"jwt_token\":\"eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLXVzZXItaWQiOiI1OTRkZGVlNC0xZWM5LTRiY2QtYTcyZS0zOTllNjVmNmFiZGIiLCJ4LWhhc3VyYS1hbGxvd2VkLXJvbGVzIjpbInVzZXIiLCJtZSJdLCJ4LWhhc3VyYS1kZWZhdWx0LXJvbGUiOiJ1c2VyIn0sInN1YiI6IjU5NGRkZWU0LTFlYzktNGJjZC1hNzJlLTM5OWU2NWY2YWJkYiIsImlzcyI6Im5ob3N0IiwiaWF0IjoxNjM0NTI0NjcxLCJleHAiOjE2MzQ1MjU1NzF9.DOYVJ_hr3D34mjFJzgpLg7nJVPX1EDPkeZEew3H0At4\",\"jwt_expires_in\":900000,\"user\":{\"id\":\"594ddee4-1ec9-4bcd-a72e-399e65f6abdb\",\"display_name\":\"user-1@nhost.io\",\"email\":\"user-1@nhost.io\"},\"refresh_token\":\"0002be0d-6060-4c32-8ffb-b5eb9e8c2dd3\"}"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:9001/auth/mfa/generate",
        "headers": {
          "content-type": "application/json; charset=utf-8",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLXVzZXItaWQiOiI1OTRkZGVlNC0xZWM5LTRiY2QtYTcyZS0zOTllNjVmNmFiZGIiLCJ4LWhhc3VyYS1hbGxvd2VkLXJvbGVzIjpbInVzZXIiLCJtZSJdLCJ4LWhhc3VyYS1kZWZhdWx0LXJvbGUiOiJ1c2VyIn0sInN1YiI6IjU5NGRkZWU0LTFlYzktNGJjZC1hNzJlLTM5OWU2NWY2YWJkYiIsImlzcyI6Im5ob3N0IiwiaWF0IjoxNjM0NTI0NjcxLCJleHAiOjE2MzQ1MjU1NzF9.DOYVJ_hr3D34mjFJzgpLg7nJVPX1EDPkeZEew3H0At4"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "x-ratelimit-reset": "1634525484",
          "date": "Mon, 18 Oct 2021 02:37:51 GMT",
          "x-ratelimit-limit": "1000",
          "vary": "Origin",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "x-ratelimit-remaining": "921",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "access-control-allow-credentials": "true",
          "keep-alive": "timeout=5",
          "content-length": "3678",
          "x-download-options": "noopen",
          "etag": "W/\"e5e-5Kj2PNatQOp3xisnb9jnCDNVvhw\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"image_url\":\"data:image/png;base64,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\",\"otp_secret\":\"BFGAQASIKBIBYJ2Y\"}"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:9001/auth/mfa/enable",
        "headers": {
          "content-type": "application/json; charset=utf-8",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLXVzZXItaWQiOiI1OTRkZGVlNC0xZWM5LTRiY2QtYTcyZS0zOTllNjVmNmFiZGIiLCJ4LWhhc3VyYS1hbGxvd2VkLXJvbGVzIjpbInVzZXIiLCJtZSJdLCJ4LWhhc3VyYS1kZWZhdWx0LXJvbGUiOiJ1c2VyIn0sInN1YiI6IjU5NGRkZWU0LTFlYzktNGJjZC1hNzJlLTM5OWU2NWY2YWJkYiIsImlzcyI6Im5ob3N0IiwiaWF0IjoxNjM0NTI0NjcxLCJleHAiOjE2MzQ1MjU1NzF9.DOYVJ_hr3D34mjFJzgpLg7nJVPX1EDPkeZEew3H0At4"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"code\":\"759937\"}"
        }
      },
      "response": {
        "status": 204,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "x-ratelimit-reset": "1634525484",
          "date": "Mon, 18 Oct 2021 02:37:51 GMT",
          "x-ratelimit-limit": "1000",
          "vary": "Origin",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "x-ratelimit-remaining": "920",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "access-control-allow-credentials": "true",
          "keep-alive": "timeout=5",
          "x-download-options": "noopen",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "iso-8859-1",
          "string": ""
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:9001/auth/logout?refresh_token=0002be0d-6060-4c32-8ffb-b5eb9e8c2dd3",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"all\":false}"
        }
      },
      "response": {
        "status": 204,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "x-ratelimit-reset": "1634525484",
          "date": "Mon, 18 Oct 2021 02:37:51 GMT",
          "x-ratelimit-limit": "1000",
          "vary": "Origin",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "x-ratelimit-remaining": "919",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "access-control-allow-credentials": "true",
          "keep-alive": "timeout=5",
          "x-download-options": "noopen",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "iso-8859-1",
          "string": ""
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:9001/auth/login",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"email\":\"user-1@nhost.io\",\"password\":\"password-1\",\"cookie\":false}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "x-ratelimit-reset": "1634525484",
          "date": "Mon, 18 Oct 2021 02:37:51 GMT",
          "x-ratelimit-limit": "1000",
          "vary": "Origin",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "x-ratelimit-remaining": "918",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "access-control-allow-credentials": "true",
          "keep-alive": "timeout=5",
          "content-length": "60",
          "x-download-options": "noopen",
          "etag": "W/\"3c-Ah6JpvsNGoYg/X137L1hLDBy1p8\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"mfa\":true,\"ticket\":\"c2f413ff-43d8-4d04-86c1-82f06e1efa9c\"}"
        }
      }
    },
    {
      "request": {
        "method": "post",
        "uri": "http://localhost:9001/auth/mfa/totp",
        "headers": {
          "content-type": "application/json; charset=utf-8"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"code\":\"759937\",\"ticket\":\"c2f413ff-43d8-4d04-86c1-82f06e1efa9c\"}"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "connection": "keep-alive",
          "surrogate-control": "no-store",
          "set-cookie": "refresh_token=e39d3cf2-764e-4c69-af9e-857537d44d75; Max-Age=2592000; Path=/; Expires=Wed, 17 Nov 2021 02:37:51 GMT; HttpOnly; SameSite=Lax,permission_variables=%7B%22user-id%22%3A%22594ddee4-1ec9-4bcd-a72e-399e65f6abdb%22%2C%22allowed-roles%22%3A%5B%22user%22%2C%22me%22%5D%2C%22default-role%22%3A%22user%22%7D; Max-Age=2592000; Path=/; Expires=Wed, 17 Nov 2021 02:37:51 GMT; HttpOnly; SameSite=Lax",
          "cache-control": "no-store, no-cache, must-revalidate, proxy-revalidate",
          "x-dns-prefetch-control": "off",
          "x-ratelimit-reset": "1634525484",
          "date": "Mon, 18 Oct 2021 02:37:51 GMT",
          "x-ratelimit-limit": "1000",
          "vary": "Origin",
          "strict-transport-security": "max-age=15552000; includeSubDomains",
          "x-ratelimit-remaining": "917",
          "content-type": "application/json; charset=utf-8",
          "pragma": "no-cache",
          "x-xss-protection": "1; mode=block",
          "access-control-allow-credentials": "true",
          "keep-alive": "timeout=5",
          "content-length": "557",
          "x-download-options": "noopen",
          "etag": "W/\"22d-LAOaZ27XLUY2uyBDc6ZeB1biZX8\"",
          "x-frame-options": "SAMEORIGIN",
          "x-content-type-options": "nosniff",
          "expires": "0"
        },
        "body": {
          "encoding": "utf-8",
          "string": "{\"jwt_token\":\"eyJhbGciOiJIUzI1NiJ9.eyJodHRwczovL2hhc3VyYS5pby9qd3QvY2xhaW1zIjp7IngtaGFzdXJhLXVzZXItaWQiOiI1OTRkZGVlNC0xZWM5LTRiY2QtYTcyZS0zOTllNjVmNmFiZGIiLCJ4LWhhc3VyYS1hbGxvd2VkLXJvbGVzIjpbInVzZXIiLCJtZSJdLCJ4LWhhc3VyYS1kZWZhdWx0LXJvbGUiOiJ1c2VyIn0sInN1YiI6IjU5NGRkZWU0LTFlYzktNGJjZC1hNzJlLTM5OWU2NWY2YWJkYiIsImlzcyI6Im5ob3N0IiwiaWF0IjoxNjM0NTI0NjcxLCJleHAiOjE2MzQ1MjU1NzF9.DOYVJ_hr3D34mjFJzgpLg7nJVPX1EDPkeZEew3H0At4\",\"jwt_expires_in\":900000,\"user\":{\"id\":\"594ddee4-1ec9-4bcd-a72e-399e65f6abdb\",\"display_name\":\"user-1@nhost.io\",\"email\":\"user-1@nhost.io\"}}"
        }
      }
    }
  ]
}